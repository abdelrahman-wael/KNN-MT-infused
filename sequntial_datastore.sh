# flatIndexing
# create datastore
python master_script.py --log-folder /home/ababouelenin/ds/test_sample_0.ds/logs --slurm-name vw --bytes-per-token 2 --model /home/ababouelenin/CustomTranslation/data/training_dir/checkpoints_deen_pretrained/checkpoint_best.pt --bpe sentencepiece --bpecodes /home/ababouelenin/CustomTranslation/data/vocab/deen_spm/sentencepiece.bpe.vocab --save-data /home/ababouelenin/ds/test_sample_0.ds/encoded/bin/ --binfile train.de-en.en.bin --num-shards 1 --dstore-mmap /home/ababouelenin/ds/test_sample_0.ds/dstore_flatindexing/index_only --num-for-training 425 --code-size 64 --ncentroids 4096 --train-index /home/ababouelenin/ds/test_sample_0.ds/dstore_flatindexing/index_only.4096.index.trained  --faiss-index /home/ababouelenin/ds/test_sample_0.ds/dstore_flatindexing/index_only.4096.index --write-merged-index /home/ababouelenin/ds/test_sample_0.ds/dstore_flatindexing/index_only.4096.index --corpus-identifiers vw --add-keys-job 
# generate sentence / eval blue
python fairseq_cli/generate.py /home/ababouelenin/de_chunks/sent_spm_00000.bin --max-tokens 4096 --gen-subset train --path /mnt/mainz01eus/ababouelenin/projects/CustomTranslation/debugging_node/knnmt/blob_data/training_dir/checkpoints_deen_pretrained/checkpoint_best.pt --bpe sentencepiece --beam 1 --remove-bpe --tokenizer moses --moses-source-lang de --moses-target-lang en --scoring sacrebleu --knnmt --k 1 --probe 32 --indexfile /home/ababouelenin/ds/test_sample_0.ds/dstore_flatindexing/index_only.4096.index.vw.0 --model-overrides "{'knn_keytype': 'last_ffn_input'}" --knn-keytype last_ffn_input --knn-embed-dim 512 --no-load-keys  --knn-temp 10 --knn-sim-func do_not_recomp_l2 --lmbda 0.8 --max-sentences 1 --use-faiss-only
